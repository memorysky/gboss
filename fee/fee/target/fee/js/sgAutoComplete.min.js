(function($){var idx=-1;var create=function(obj,settings){var bUList=$('#'+settings.bUList);var bId=$('#'+settings.bId);var likeAttr=settings.likeAttr;var oparams=settings.oparams;var url=settings.url;var backLi=settings.backLi;var backLiName=null;var backLiText=null;var backLiTexts=null;var clearIds=settings.clearIds;if(backLi){backLiName='v.'+backLi.name;backLiText=backLi.text;backLiText=backLiText.split(',');if(backLiText){backLiTexts=backLiText.join('+"   "+v.');backLiTexts='v.'+backLiTexts}}var recommend=function(){if(bUList){bUList.html('');idx=-1;var params={};params.pageNo=1;params.pageSize=settings.rp;params.filter={};params.filter[likeAttr]=obj.val();if(oparams){$.each(oparams,function(k,v){params.filter[k]=v})}$.ajax({type:'post',async:true,contentType:'application/json',dataType:'json',url:url,data:JSON.stringify(params),success:function(data){if(data){if(data.items.length>0){bUList.html('')}else{bUList.append('<li>没有数据！</li>')}$.each(data.items,function(k,v){bUList.append('<li name='+eval(backLiName)+' id="rec_'+k+'">'+eval(backLiTexts)+'</li>')});if(data.items.length==1){var liFirst=$('li:first',bUList);select_word(liFirst.text(),liFirst.attr('name'),true);$('li',bUList).show()}bUList.show()}else{bUList.hide()}},error:function(res,error){$(document).sgPup({message:'message_alert',text:res.responseText})}})}};function next_word(idx){$('li',bUList).removeClass("current");$("#rec_"+idx).addClass("current");var ul=$('li',bUList).parent().parent();var input=ul.find("input[type='text']");input.val($("#rec_"+idx).text())}function select_word(word,id,isClearHide){bId.val(id);obj.val(word);if(!isClearHide){bUList.html('').hide()}if(settings.queryBack){settings.queryBack()}}$(window.document).keydown(function(event){if(event.keyCode==13){return false}});obj.keyup(function(event,ekeyCode){max=$('li',bUList).length-1;var liCurrent=$("li.current",bUList);if(event.keyCode==40){if(idx<max){idx++}next_word(idx)}else{if(event.keyCode==38){if(idx>0){idx--}next_word(idx)}else{if(event.keyCode==13||ekeyCode==13){var selectedLi=$("#rec_"+idx);var ul=selectedLi.parent();var div=ul.parent();var input=div.find("input[type='text']");if(input.val()!=""&&input.val()==selectedLi.text()){var hiddenInput=div.find("input[type='hidden']");hiddenInput.val(selectedLi.attr("name"));settings.queryBack();ul.html("")}else{recommend()}}}}event.stopPropagation();event.preventDefault()});obj.on('input',function(e){var $this=$(this);if($this.val().length<1){var ul=$this.parent().find("ul");ul.html("");bId.val('')}});$("body").on("click","#"+settings.bUList+" li",function(event){var id=$('#'+settings.bUList+' li.current').attr('name');if(id){select_word($(this).text(),id)}event.stopPropagation();event.preventDefault()});$("body").on("mouseover","#"+settings.bUList+" li",function(event){var id=$(this).attr("id");if(id){idx=id.replace(/[^0-9]/ig,"");next_word(idx)}event.stopPropagation();event.preventDefault()});$(document).bind('click',function(){$('li',bUList).hide()})};var methods={init:function(options){return this.each(function(){var $this=$(this);var settings=$this.data('sgAutoComplete');if(typeof(settings)=='undefined'){var defaults={bId:'',bUList:'',width:150,height:20,url:'datagrid.json',likeAttr:'',oparms:{},backLi:{},clearIds:'',exporturl:false,method:'POST',dataType:'json',errormsg:'连接出错！',usepager:false,page:1,total:1,pages:1,useRp:true,rp:10,rpOptions:[10,15,20,30,50],pagestat:'显示 {from} 到 {to} 条&nbsp;&nbsp;&nbsp;&nbsp;共 {total} 条纪录',procmsg:'正在读取数据……！',query:{},nomsg:'没有数据！',onChangeSort:false,queryBack:false};settings=$.extend({},defaults,options);$this.data('sgAutoComplete',settings)}else{settings=$.extend({},settings,options)}create($this,settings)})},destroy:function(options){return $(this).each(function(){var $this=$(this);$this.removeData('sgAutoComplete')})},val:function(options){var someValue=this.eq(0).html();return someValue}};$.fn.sgAutoComplete=function(){var method=arguments[0];if(methods[method]){method=methods[method];arguments=Array.prototype.slice.call(arguments,1)}else{if(typeof(method)=='object'||!method){method=methods.init}else{$.error('Method '+method+' does not exist on jQuery.sgAutoComplete');return this}}return method.apply(this,arguments)}})(jQuery);