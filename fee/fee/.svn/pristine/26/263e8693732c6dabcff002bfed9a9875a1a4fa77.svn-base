(function($){var create=function(obj,settings){var mask=$('<div></div>');var win=$('<div></div>');var header=$('<div></div>');var body=$('<div></div>');var title=$('<div></div>');var tool=$('<div></div>');var toolClose=$('<a href="javascript:void(0);"></a>');var footer=$('<div></div>');var clientWidth=$(window).outerWidth();var clientHeight=$(window).outerHeight();win.addClass('window');win.attr('id',settings.id);win.width(settings.width);win.css('left',(clientWidth-settings.width)/2);win.css('top',(clientHeight-settings.height-60)/2);win.css('z-index',settings.z_index);toolClose.addClass('window-tool-close');toolClose.click(function(){var isClose=true;if(settings.beforeClose){isClose=settings.beforeClose();}if(isClose){obj.removeData('sgWindow');var maskId="#"+settings.id+"_mask";$(maskId).remove();var winId="#"+settings.id;$(winId).remove();}});tool.addClass('window-tool');tool.append(toolClose);title.addClass('window-title');title.append(settings.title);header.addClass('window-header');header.width(settings.width);header.append(title);header.append(tool);win.append(header);body.addClass('window-body');body.height(settings.height-25);body.load(settings.url,settings.success);win.append(body);if(settings.buttons){footer.addClass('window-footer');footer.addClass('window-body-noheader');footer.addClass('window-body-noborder');footer.css('text-align','center');footer.css('padding-top','5px');footer.width(settings.width);$.each(settings.buttons,function(k,v){if(v.type=='submit'){var sub=$('<input type="submit">');sub.attr('form',settings.form);sub.val(v.name);sub.css('margin-right','10px');if(v.onpress){sub.click(function(){(v.onpress)();})};footer.append(sub);}else if(v.type=='reset'){var sub=$('<input type="reset">');sub.attr('form',settings.form);sub.val(v.name);sub.css('margin-right','10px');if(v.onpress){sub.click(function(){(v.onpress)();})};footer.append(sub);}else{var sub=$('<input type="button">');sub.attr('form',settings.form);sub.val(v.name);sub.css('margin-right','10px');if(v.onpress){sub.click(function(){(v.onpress)();})};footer.append(sub);};});win.append(footer);};win.show();mask.addClass('window-mask');mask.attr('id',settings.id+"_mask");mask.show();$(document.body).append(mask);$(document.body).append(win);DragAndDrop.Register(win,header);};var methods={init:function(options){return this.each(function(){var $this=$(this);var settings=$this.data('sgWindow');if(typeof(settings)=='undefined'){var defaults={id:false,title:false,url:false,width:300,height:200,z_index:9000,beforeClose:false};settings=$.extend({},defaults,options);$this.data('sgWindow',settings);}else{settings=$.extend({},settings,options);};create($this,settings);});},close:function(options){var isClose=true;if(options.beforeClose){isClose=options.beforeClose();}if(isClose){var mask="#"+options.id+"_mask";$(mask).remove();$("#"+options.id).remove();$(this).removeData('sgWindow');}},destroy:function(options){return $(this).each(function(){var $this=$(this);$this.removeData('sgWindow');});},val:function(options){var someValue=this.eq(0).html();return someValue;}};$.fn.sgWindow=function(){var method=arguments[0];if(methods[method]){method=methods[method];arguments=Array.prototype.slice.call(arguments,1);}else if(typeof(method)=='object'||!method){method=methods.init;}else{$.error('Method '+method+' does not exist on jQuery.sgWindow');return this;};return method.apply(this,arguments);};var DragAndDrop=function(){var _clientWidth;var _clientHeight;var _controlObj;var _dragObj;var _flag=false;var _dragObjCurrentLocation;var _mouseLastLocation;var getElementDocument=function(element){return element.ownerDocument||element.document;};var dragMouseDownHandler=function(evt){if(_dragObj){evt=evt||window.event;_clientWidth=document.body.clientWidth;_clientHeight=document.documentElement.scrollHeight;$("#jd_dialog_m_b_1").css("display","");_flag=true;_dragObjCurrentLocation={x:$(_dragObj).offset().left,y:$(_dragObj).offset().top};_mouseLastLocation={x:evt.screenX,y:evt.screenY};$(document).bind("mousemove",dragMouseMoveHandler);$(document).bind("mouseup",dragMouseUpHandler);if(evt.preventDefault){evt.preventDefault();}else{evt.returnValue=false;};};};var dragMouseMoveHandler=function(evt){if(_flag){evt=evt||window.event;var _mouseCurrentLocation={x:evt.screenX,y:evt.screenY};_dragObjCurrentLocation.x=_dragObjCurrentLocation.x+(_mouseCurrentLocation.x-_mouseLastLocation.x);_dragObjCurrentLocation.y=_dragObjCurrentLocation.y+(_mouseCurrentLocation.y-_mouseLastLocation.y);_mouseLastLocation=_mouseCurrentLocation;$(_dragObj).css("left",_dragObjCurrentLocation.x+"px");$(_dragObj).css("top",_dragObjCurrentLocation.y+"px");if(evt.preventDefault){evt.preventDefault();}else{evt.returnValue=false;};};};var dragMouseUpHandler=function(evt){if(_flag){evt=evt||window.event;$("#jd_dialog_m_b_1").css("display","none");cleanMouseHandlers();_flag=false;};};var cleanMouseHandlers=function(){if(_controlObj){$(_controlObj.document).unbind("mousemove");$(_controlObj.document).unbind("mouseup");};};return{Register:function(dragObj,controlObj){_dragObj=dragObj;_controlObj=controlObj;$(_controlObj).bind("mousedown",dragMouseDownHandler);}};}();})(jQuery);